<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMD CENTER | ADMIN NEON</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --admin-gold: #fbbf24; --neon-cyan: #00f2ff; }
        body { background: #06080c; color: white; font-family: 'Rajdhani', sans-serif; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .admin-card { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(251, 191, 36, 0.2); backdrop-filter: blur(10px); }
        .status-pill { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .btn-gold { background: var(--admin-gold); color: black; font-weight: 900; transition: 0.3s; }
        .btn-gold:hover { box-shadow: 0 0 20px var(--admin-gold); transform: scale(1.02); }
        input, select, textarea { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px; border-radius: 4px; outline: none; }
        input:focus { border-color: var(--admin-gold); }
    </style>
</head>
<body class="p-8">

    <header class="flex justify-between items-center mb-12 border-b border-yellow-500/20 pb-6">
        <div>
            <h1 class="font-orbitron text-2xl font-black text-yellow-500 tracking-tighter uppercase">Command_Center <span class="text-white text-xs block tracking-[0.5em]">Administrador de Arena</span></h1>
        </div>
        <div class="flex gap-4">
            <div id="db-status" class="flex items-center gap-2 bg-green-500/10 text-green-500 px-4 py-2 rounded border border-green-500/20 text-xs font-bold">
                <span class="h-2 w-2 bg-green-500 rounded-full animate-pulse"></span> DB_CONNECTED
            </div>
            <button onclick="location.reload()" class="bg-white/5 hover:bg-white/10 p-2 rounded">ðŸ”„</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <div class="lg:col-span-1 space-y-6">
            <div class="admin-card p-6 rounded-xl">
                <h3 class="font-orbitron text-sm mb-6 text-yellow-500 italic">Crear_Nuevo_DesafÃ­o</h3>
                <div class="flex flex-col gap-3">
                    <input id="t-nombre" type="text" placeholder="Nombre del Torneo">
                    <select id="t-juego">
                        <option value="Valorant">Valorant</option>
                        <option value="Wild Rift">Wild Rift</option>
                        <option value="Free Fire">Free Fire</option>
                        <option value="LoL">League of Legends</option>
                    </select>
                    <input id="t-cupos" type="number" placeholder="Cupos (Ej: 16)">
                    <button onclick="crearTorneo()" class="btn-gold py-3 text-xs uppercase mt-2">Publicar en Arena</button>
                </div>
            </div>

            <div class="admin-card p-6 rounded-xl">
                <h3 class="font-orbitron text-sm mb-4 text-yellow-500 italic">Anuncio_Global</h3>
                <textarea id="n-texto" placeholder="Mensaje para el Hero de los clientes..." class="w-full text-xs"></textarea>
                <button onclick="publicarNoticia()" class="w-full bg-white text-black py-2 mt-2 font-bold text-xs uppercase">Actualizar Hero</button>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="admin-card p-6 rounded-xl min-h-[400px]">
                <h3 class="font-orbitron text-sm mb-6 text-cyan-400 italic">Base_de_Guerreros</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-xs">
                        <thead class="text-zinc-500 uppercase border-b border-white/5">
                            <tr>
                                <th class="pb-4">Guerrero</th>
                                <th class="pb-4 text-center">XP</th>
                                <th class="pb-4 text-center">Wins</th>
                                <th class="pb-4 text-right">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="lista-usuarios">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="admin-card p-6 rounded-xl">
                <h3 class="font-orbitron text-sm mb-6 text-pink-500 italic">Tickets_Soporte_Pendientes</h3>
                <div id="lista-tickets" class="space-y-3">
                    </div>
            </div>
        </div>

        <div class="lg:col-span-1">
            <div class="admin-card p-6 rounded-xl">
                <h3 class="font-orbitron text-sm mb-6 text-yellow-500 italic">Resumen_Operativo</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center border-b border-white/5 pb-2">
                        <span class="text-xs text-zinc-400">Torneos Activos</span>
                        <span id="stat-torneos" class="font-orbitron text-lg text-cyan-400">0</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-white/5 pb-2">
                        <span class="text-xs text-zinc-400">Total Usuarios</span>
                        <span id="stat-users" class="font-orbitron text-lg text-white">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const _supa = supabase.createClient('https://qxvqxdsfcvdmanxtzmkn.supabase.co', 'sb_publishable_X2_itSXVSMUgkZeDLSE3KQ_HxD1Jf07');

        // --- FUNCIONES DE GESTIÃ“N ---
        async function crearTorneo() {
            const nombre = document.getElementById('t-nombre').value;
            const juego = document.getElementById('t-juego').value;
            const capacidad = document.getElementById('t-cupos').value;

            const { error } = await _supa.from('torneos').insert({ nombre, juego, capacidad });
            if(!error) { alert("TORNEO LANZADO A LA RED"); location.reload(); }
        }

        async function cargarUsuarios() {
            const { data } = await _supa.from('perfiles').select('*').order('xp', { ascending: false });
            const tbody = document.getElementById('lista-usuarios');
            tbody.innerHTML = data.map(u => `
                <tr class="border-b border-white/5">
                    <td class="py-4 flex items-center gap-2">
                        <img src="${u.avatar_url}" class="w-6 h-6 rounded-full">
                        <span>${u.nombre}</span>
                    </td>
                    <td class="text-center text-cyan-400 font-bold">${u.xp}</td>
                    <td class="text-center text-pink-500 font-bold">${u.victorias}</td>
                    <td class="text-right">
                        <button onclick="modificarXP('${u.id}', ${u.xp + 100})" class="bg-cyan-500/20 text-cyan-400 p-1 rounded text-[8px] font-bold">+100 XP</button>
                        <button onclick="modificarVictoria('${u.id}', ${u.victorias + 1})" class="bg-pink-500/20 text-pink-500 p-1 rounded text-[8px] font-bold">+WIN</button>
                    </td>
                </tr>
            `).join('');
            document.getElementById('stat-users').innerText = data.length;
        }

        async function modificarXP(id, total) {
            await _supa.from('perfiles').update({ xp: total }).eq('id', id);
            cargarUsuarios();
        }

        async function modificarVictoria(id, total) {
            await _supa.from('perfiles').update({ victorias: total, xp: total * 1000 }).eq('id', id);
            cargarUsuarios();
        }

        async function cargarTickets() {
            const { data } = await _supa.from('tickets_soporte').select('*, perfiles(nombre)').eq('estado', 'PENDIENTE');
            const box = document.getElementById('lista-tickets');
            box.innerHTML = data.map(t => `
                <div class="bg-black/40 p-4 border border-white/5 rounded">
                    <div class="flex justify-between mb-2">
                        <span class="text-[9px] font-black text-yellow-500 uppercase">${t.perfiles.nombre}</span>
                        <span class="text-[8px] text-zinc-600">${new Date(t.created_at).toLocaleDateString()}</span>
                    </div>
                    <p class="text-[10px] font-bold mb-3">${t.asunto}: ${t.mensaje}</p>
                    <button onclick="resolverTicket(${t.id})" class="text-[8px] bg-green-500 text-black px-3 py-1 font-black uppercase rounded">Marcar Resuelto</button>
                </div>
            `).join('');
        }

        async function resolverTicket(id) {
            await _supa.from('tickets_soporte').update({ estado: 'RESUELTO' }).eq('id', id);
            cargarTickets();
        }

        async function publicarNoticia() {
            const contenido = document.getElementById('n-texto').value;
            await _supa.from('noticias').insert({ contenido });
            alert("AVISO PUBLICADO");
        }

        // Inicializar
        cargarUsuarios();
        cargarTickets();
        _supa.from('torneos').select('*').then(({data}) => document.getElementById('stat-torneos').innerText = data.length);

    </script>
</body>
</html>
