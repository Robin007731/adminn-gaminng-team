<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZONA GAMER | CONTROL PANEL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff0055;
            --bg: #0a0a0f;
            --card: #151520;
            --text: #ffffff;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #c0392b;
            --whatsapp: #25d366;
            --discord: #5865F2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); display: flex; min-height: 100vh; }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px; height: 100vh; background: #000; border-right: 2px solid var(--primary);
            position: fixed; left: -260px; transition: 0.3s; z-index: 1000;
        }
        .sidebar.active { left: 0; }
        .menu-btn { position: fixed; top: 20px; left: 20px; font-size: 1.5rem; cursor: pointer; color: var(--primary); z-index: 1100; background: var(--card); padding: 5px 15px; border-radius: 5px; border: 1px solid var(--primary); }

        .nav-link { padding: 15px 20px; display: block; color: white; text-decoration: none; border-bottom: 1px solid #111; cursor: pointer; }
        .nav-link:hover { background: var(--primary); }

        /* --- CONTENIDO --- */
        main { flex-grow: 1; padding: 80px 20px; width: 100%; }
        .section { display: none; max-width: 900px; margin: auto; }
        .section.active { display: block; }

        .admin-card { background: var(--card); padding: 25px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
        h3 { font-family: 'Orbitron'; color: var(--primary); margin-bottom: 15px; text-transform: uppercase; }

        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #444; color: white; border-radius: 5px; }
        .btn-admin { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-family: 'Orbitron'; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* --- TABLAS Y BADGES --- */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #222; }
        th { color: var(--primary); font-family: 'Orbitron'; font-size: 0.7rem; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .status-active { background: var(--success); }
        .status-banned { background: var(--danger); }
        .status-suspended { background: var(--warning); }

        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

        /* --- MEN√ö SOCIAL FLOTANTE (NUEVO) --- */
        .social-menu {
            position: fixed; bottom: 30px; right: 30px;
            display: flex; flex-direction: column-reverse;
            gap: 15px; z-index: 2000;
        }
        .social-btn {
            width: 55px; height: 55px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; text-decoration: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0); position: relative;
        }
        .btn-toggle { background: var(--primary); transform: scale(1) !important; z-index: 2001; cursor: pointer; }
        .social-menu.active .social-btn { transform: scale(1); }
        .social-menu.active .btn-toggle { transform: rotate(135deg) !important; background: #333; }
        
        .btn-ws { background: var(--whatsapp); }
        .btn-ds { background: var(--discord); }
        .social-btn svg { width: 28px; height: 28px; fill: white; }

        .notif-badge {
            position: absolute; top: 0; right: 0;
            width: 14px; height: 14px; background: #ff4757;
            border-radius: 50%; border: 2px solid var(--discord);
        }
    </style>
</head>
<body>

    <div class="social-menu" id="social-menu">
        <div class="social-btn btn-toggle" onclick="toggleSocialMenu()">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        </div>
        <a href="https://chat.whatsapp.com/FsKHwkSsDjuIKU5Wh4QWa3" target="_blank" class="social-btn btn-ws">
            <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.94 3.659 1.437 5.63 1.438h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
        </a>
        <a href="https://discord.gg/BDRbZmhUjW" target="_blank" class="social-btn btn-ds">
            <div class="notif-badge"></div>
            <svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028 14.09 14.09 0 001.226-1.994.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03z"/></svg>
        </a>
    </div>

    <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>

    <nav class="sidebar" id="sidebar">
        <div style="padding: 40px 20px; text-align: center;">
            <h2 style="color: var(--primary); font-family: 'Orbitron';">ZONA ADMIN</h2>
        </div>
        <div class="nav-link" onclick="showSection('sec-publicar')">üì¢ Publicaciones</div>
        <div class="nav-link" onclick="showSection('sec-ganadores')">üèÜ Dar Ganadores</div>
        <div class="nav-link" onclick="showSection('sec-usuarios')">üë• Usuarios</div>
        <div class="nav-link" onclick="showSection('sec-ajustes')">‚öôÔ∏è Ajustes Jugadores</div>
    </nav>

    <main>
        <div id="sec-publicar" class="section active">
            <h3>Crear Nuevo Torneo</h3>
            <div class="admin-card">
                <input type="text" id="t-nombre" placeholder="Nombre del Torneo">
                <textarea id="t-detalles" placeholder="Reglas, requisitos y horarios..."></textarea>
                <div class="grid-3">
                    <input type="number" id="pts-1" placeholder="Pts 1er">
                    <input type="number" id="pts-2" placeholder="Pts 2do">
                    <input type="number" id="pts-3" placeholder="Pts 3er">
                </div>
                <input type="number" id="pts-participacion" placeholder="Pts participaci√≥n (Resto)" value="2">
                <button class="btn-admin" onclick="publicarTorneo()">PUBLICAR TORNEO</button>
            </div>
        </div>

        <div id="sec-ganadores" class="section">
            <h3>Asignar Podio y Repartir Puntos</h3>
            <div class="admin-card">
                <label>ü•á 1er Puesto</label>
                <select id="sel-p1" class="user-list-select"></select>
                <label>ü•à 2do Puesto</label>
                <select id="sel-p2" class="user-list-select"></select>
                <label>ü•â 3er Puesto</label>
                <select id="sel-p3" class="user-list-select"></select>
                <button class="btn-admin" style="background: var(--success);" onclick="repartirPuntosGral()">FINALIZAR Y REPARTIR</button>
            </div>
        </div>

        <div id="sec-usuarios" class="section">
            <h3>Gesti√≥n de Estado</h3>
            <div class="admin-card">
                <table>
                    <thead>
                        <tr>
                            <th>NICK</th>
                            <th>ESTADO</th>
                            <th>ACCI√ìN</th>
                        </tr>
                    </thead>
                    <tbody id="table-status"></tbody>
                </table>
            </div>
        </div>

        <div id="sec-ajustes" class="section">
            <h3>Editar Puntos Manualmente</h3>
            <div class="admin-card">
                <select id="sel-edit-user" class="user-list-select"></select>
                <input type="number" id="new-points" placeholder="Nuevos Puntos">
                <button class="btn-admin" onclick="actualizarPuntosManual()">ACTUALIZAR PUNTOS</button>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, increment, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAh6MqrL2KvhTfeXpEYvRNvKP-6vApMnAg",
            authDomain: "zona-gamer-live.firebaseapp.com",
            projectId: "zona-gamer-live",
            storageBucket: "zona-gamer-live.firebasestorage.app",
            messagingSenderId: "458669601177",
            appId: "1:458669601177:web:9b45b6f259d8b1aa9ee308"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- L√ìGICA DEL MEN√ö SOCIAL (NUEVO) ---
        window.toggleSocialMenu = () => {
            document.getElementById('social-menu').classList.toggle('active');
        };

        // NAVEGACI√ìN
        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');
        window.showSection = (id) => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            toggleSidebar();
        };

        // PUBLICAR TORNEO
        window.publicarTorneo = async () => {
            const nombre = document.getElementById('t-nombre').value;
            if(!nombre) return alert("Nombre obligatorio");
            
            await setDoc(doc(db, "tournaments", "activo"), {
                nombre,
                detalles: document.getElementById('t-detalles').value,
                puntos: [
                    parseInt(document.getElementById('pts-1').value) || 0,
                    parseInt(document.getElementById('pts-2').value) || 0,
                    parseInt(document.getElementById('pts-3').value) || 0
                ],
                puntos_extra: parseInt(document.getElementById('pts-participacion').value) || 2,
                fecha: new Date()
            });
            alert("Torneo publicado");
        };

        // CARGAR USUARIOS
        const userCache = [];
        onSnapshot(collection(db, "users"), (snapshot) => {
            const selects = document.querySelectorAll('.user-list-select');
            const tableStatus = document.getElementById('table-status');
            userCache.length = 0;
            let options = '<option value="">Seleccionar Usuario...</option>';
            tableStatus.innerHTML = "";

            snapshot.forEach(snap => {
                const user = { id: snap.id, ...snap.data() };
                userCache.push(user);
                options += `<option value="${user.id}">${user.username}</option>`;
                tableStatus.innerHTML += `
                    <tr>
                        <td>${user.username}</td>
                        <td><span class="badge ${getStatusClass(user.status)}">${user.status || 'active'}</span></td>
                        <td>
                            <button onclick="cambiarEstado('${user.id}', 'banned')" style="color:red; background:none; border:none; cursor:pointer">Ban</button> |
                            <button onclick="suspender('${user.id}')" style="color:orange; background:none; border:none; cursor:pointer">Susp</button> |
                            <button onclick="cambiarEstado('${user.id}', 'active')" style="color:green; background:none; border:none; cursor:pointer">Act</button>
                        </td>
                    </tr>
                `;
            });
            selects.forEach(s => s.innerHTML = options);
        });

        const getStatusClass = (s) => {
            if(s === 'banned') return 'status-banned';
            if(s === 'suspended') return 'status-suspended';
            return 'status-active';
        }

        window.repartirPuntosGral = async () => {
            const p1 = document.getElementById('sel-p1').value;
            const p2 = document.getElementById('sel-p2').value;
            const p3 = document.getElementById('sel-p3').value;
            const v1 = parseInt(document.getElementById('pts-1').value) || 0;
            const v2 = parseInt(document.getElementById('pts-2').value) || 0;
            const v3 = parseInt(document.getElementById('pts-3').value) || 0;
            const vResto = parseInt(document.getElementById('pts-participacion').value) || 2;

            if(!p1) return alert("M√≠nimo elige el 1er puesto");

            for(let user of userCache) {
                let suma = vResto;
                if(user.id === p1) suma = v1;
                else if(user.id === p2) suma = v2;
                else if(user.id === p3) suma = v3;
                await updateDoc(doc(db, "users", user.id), { points: increment(suma) });
            }
            alert("¬°Puntos repartidos!");
        };

        window.cambiarEstado = async (uid, estado) => {
            await updateDoc(doc(db, "users", uid), { status: estado });
            alert("Estado actualizado");
        };

        window.suspender = async (uid) => {
            const dias = prompt("¬øCu√°ntos d√≠as de suspensi√≥n?");
            if(!dias) return;
            await updateDoc(doc(db, "users", uid), { 
                status: 'suspended',
                unlockDate: Date.now() + (dias * 24 * 60 * 60 * 1000)
            });
            alert("Usuario suspendido");
        };

        window.actualizarPuntosManual = async () => {
            const uid = document.getElementById('sel-edit-user').value;
            const pts = parseInt(document.getElementById('new-points').value);
            if(!uid || isNaN(pts)) return alert("Datos incompletos");
            await updateDoc(doc(db, "users", uid), { points: pts });
            alert("Puntos actualizados");
        };
    </script>
</body>
</html>
