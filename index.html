<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARBITRON | FUSION COMMAND ADMIN</title>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand: #00bac7;
            --brand-light: #e0f7f8;
            --danger: #ff4757;
            --sidebar: #f8fafc;
            --text-main: #1e293b;
        }

        body { 
            background-color: #f1f5f9; 
            color: var(--text-main); 
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR PROLIJO */
        aside {
            width: 280px;
            background: var(--sidebar);
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            position: fixed;
            height: 100vh;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 3rem;
        }

        .logo-icon {
            width: 45px; height: 45px;
            background: var(--brand);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-family: 'Orbitron'; font-size: 1.5rem;
        }

        .nav-link {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-radius: 10px;
            color: #64748b; font-weight: 600; transition: 0.3s;
            cursor: pointer; margin-bottom: 4px;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--brand-light);
            color: var(--brand);
        }

        /* MAIN CONTENT */
        main { flex: 1; margin-left: 280px; padding: 3rem; }

        .card {
            background: white; border-radius: 20px;
            padding: 2rem; border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: 'Orbitron'; font-size: 0.8rem; letter-spacing: 2px;
            color: var(--brand); text-transform: uppercase; margin-bottom: 1.5rem;
        }

        /* BOTONES */
        .btn-primary {
            background: var(--brand); color: white;
            padding: 10px 24px; border-radius: 8px; font-weight: 700;
            text-transform: uppercase; font-size: 0.75rem; transition: 0.3s;
        }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }

        .btn-danger {
            background: #fff; color: var(--danger); border: 1.5px solid var(--danger);
            padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 0.7rem;
        }
        .btn-danger:hover { background: var(--danger); color: white; }

        /* TABLAS PRO */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; padding: 1rem; border-bottom: 1px solid #f1f5f9; }
        td { padding: 1.2rem 1rem; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; font-weight: 600; }

        input, select {
            background: #f8fafc; border: 1px solid #e2e8f0;
            padding: 12px 16px; border-radius: 10px; width: 100%;
            margin-bottom: 1rem; transition: 0.3s;
        }
        input:focus { border-color: var(--brand); outline: none; background: white; }

        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <aside>
        <div class="logo-area">
            <div class="logo-icon">A</div>
            <div>
                <h1 style="font-family:'Orbitron'; font-size: 1.2rem; margin:0;">ARBITRON</h1>
                <p style="font-size: 0.6rem; color: #94a3b8; margin:0;">ADMIN UI v40.0</p>
            </div>
        </div>

        <nav>
            <div class="nav-link active" onclick="showView('dashboard', this)"><span>üìä</span> DASHBOARD</div>
            <div class="nav-link" onclick="showView('users', this)"><span>üë§</span> USUARIOS</div>
            <div class="nav-link" onclick="showView('tourneys', this)"><span>‚öîÔ∏è</span> TORNEOS</div>
        </nav>

        <div style="margin-top: auto;">
            <button onclick="location.href='index.html'" class="btn-danger w-full">CERRAR SESI√ìN</button>
        </div>
    </aside>

    <main>
        
        <section id="view-dashboard" class="view-section active">
            <div class="grid grid-cols-3 gap-6">
                <div class="card">
                    <p class="section-title">Usuarios</p>
                    <h2 id="count-users" style="font-size: 2.5rem; font-weight: 800;">0</h2>
                </div>
                <div class="card">
                    <p class="section-title">Torneos Hoy</p>
                    <h2 id="count-tourneys" style="font-size: 2.5rem; font-weight: 800; color: var(--brand);">0</h2>
                </div>
                <div class="card">
                    <p class="section-title">Estado Red</p>
                    <h2 style="font-size: 1.5rem; font-weight: 800; color: #22c55e;">ONLINE</h2>
                </div>
            </div>
        </section>

        <section id="view-users" class="view-section">
            <div class="card">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="section-title">Base de Datos de Usuarios</h3>
                    <input type="text" id="searchUser" placeholder="Buscar por nombre..." style="width: 250px; margin: 0;" onkeyup="filterUsers()">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>XP Global</th>
                            <th>Wins</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="view-tourneys" class="view-section">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="card lg:col-span-1">
                    <h3 class="section-title">Crear Nueva Arena</h3>
                    <input id="t-name" type="text" placeholder="Nombre del Torneo">
                    <select id="t-game">
                        <option value="Warzone">Warzone</option>
                        <option value="Fortnite">Fortnite</option>
                        <option value="Valorant">Valorant</option>
                    </select>
                    <input id="t-cap" type="number" placeholder="Capacidad (Ej: 16)">
                    <button onclick="createTournament()" class="btn-primary w-full mt-4">DESPLEGAR ARENA</button>
                </div>
                <div class="card lg:col-span-2">
                    <h3 class="section-title">Arenas Activas</h3>
                    <div id="tourneyList" class="space-y-4"></div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // CONFIG SUPABASE
        const SB_URL = 'https://qxvqxdsfcvdmanxtzmkn.supabase.co';
        const SB_KEY = 'sb_publishable_X2_itSXVSMUgkZeDLSE3KQ_HxD1Jf07';
        const _db = supabase.createClient(SB_URL, SB_KEY);

        window.onload = () => {
            loadDashboard();
        };

        function showView(id, el) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            el.classList.add('active');

            if(id === 'users') loadUsers();
            if(id === 'tourneys') loadTournaments();
        }

        async function loadDashboard() {
            const { count: uCount } = await _db.from('perfiles').select('*', { count: 'exact', head: true });
            const { count: tCount } = await _db.from('torneos').select('*', { count: 'exact', head: true });
            document.getElementById('count-users').innerText = uCount || 0;
            document.getElementById('count-tourneys').innerText = tCount || 0;
        }

        async function loadUsers() {
            const { data } = await _db.from('perfiles').select('*').order('xp', {ascending: false});
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = (data || []).map(u => `
                <tr>
                    <td>${u.nombre}</td>
                    <td style="color: var(--brand)">${u.xp}</td>
                    <td>${u.victorias}</td>
                    <td class="text-right">
                        <button onclick="editStats('${u.id}', ${u.xp}, ${u.victorias})" class="btn-primary" style="padding: 5px 12px; font-size: 0.6rem;">EDITAR</button>
                    </td>
                </tr>
            `).join('');
        }

        async function editStats(id, currentXp, currentWins) {
            const nxp = prompt("Nuevo XP:", currentXp);
            const nwins = prompt("Nuevas Victorias:", currentWins);
            if(nxp !== null && nwins !== null) {
                await _db.from('perfiles').update({ xp: parseInt(nxp), victorias: parseInt(nwins) }).eq('id', id);
                loadUsers();
            }
        }

        async function loadTournaments() {
            const { data } = await _db.from('torneos').select('*').order('created_at', {ascending: false});
            const container = document.getElementById('tourneyList');
            container.innerHTML = (data || []).map(t => `
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <div>
                        <p style="font-size: 0.6rem; color: #94a3b8; font-weight: 800; text-transform: uppercase;">${t.juego}</p>
                        <h4 style="font-weight: 800; color: #1e293b;">${t.nombre}</h4>
                        <p style="font-size: 0.75rem; color: var(--brand);">Cupos: ${t.inscritos}/${t.capacidad}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="deleteT('${t.id}')" class="btn-danger">ELIMINAR</button>
                    </div>
                </div>
            `).join('');
        }

        async function createTournament() {
            const n = document.getElementById('t-name').value;
            const g = document.getElementById('t-game').value;
            const c = document.getElementById('t-cap').value;
            
            const { error } = await _db.from('torneos').insert({
                nombre: n, juego: g, capacidad: parseInt(c), inscritos: 0
            });

            if(!error) {
                alert("Torneo Creado");
                loadTournaments();
                loadDashboard();
            }
        }

        async function deleteT(id) {
            if(confirm("¬øSeguro?")) {
                await _db.from('torneos').delete().eq('id', id);
                loadTournaments();
                loadDashboard();
            }
        }

        function filterUsers() {
            const q = document.getElementById('searchUser').value.toLowerCase();
            const rows = document.querySelectorAll('#userTableBody tr');
            rows.forEach(row => {
                const name = row.querySelector('td').innerText.toLowerCase();
                row.style.display = name.includes(q) ? '' : 'none';
            });
        }
    </script>
</body>
</html>
